---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostEntry from "../../components/PostEntry.astro";
import { getCollection } from "astro:content";
import type { GetStaticPaths, Page } from "astro";
import Pagination from "../../components/Pagination.astro";

// 筛选公开文章

export const getStaticPaths: GetStaticPaths = async ({ paginate }) => {
  const readingPosts = await getCollection("reading");

  const posts = readingPosts
    .filter((post) => post.data.public)
    .sort((a, b) => {
      const aDT = a.data.published || a.data.saved;
      const bDT = b.data.published || b.data.saved;

      return bDT.valueOf() - aDT.valueOf();
    });

  return paginate(posts, {
    pageSize: 10,
  });
};

const { page } = Astro.props as { page: Page<PostEntry> };

const allPosts = page.data;
---

<BaseLayout
  title={`Page - ${page.currentPage} - Dkphhh的收藏夹`}
  description="Dkphhh 的文章收藏夹"
  keywords={["收藏夹", "文章", "更新", "故事"]}
>
  <div class="flex-col-center h-full gap-8">
    <div class="article-list-container">
      {allPosts.map((post) => <PostEntry post={post} />)}
    </div>
    <Pagination
      currentPage={page.currentPage}
      lastPage={page.lastPage}
      pathName="reading"
    />
  </div>
</BaseLayout>
